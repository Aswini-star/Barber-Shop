<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Barber Shop</title><meta name="viewport" content="width=device-width, initial-scale=1"><style>.hidden{display:none}.btn{padding:10px 14px;border:none;border-radius:6px;background:#d4af37;color:#fff;font-weight:600}.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);align-items:center;justify-content:center;z-index:999}.modal.active{display:flex}.modal-content{background:#fff;padding:20px;border-radius:10px;width:90%;max-width:420px}table{width:100%;border-collapse:collapse}td,th{border:1px solid #ccc;padding:6px;text-align:left}</style></head>
<body>
<h2> Barber Shop</h2>
<button class="btn" id="loginBtn" onclick="openLogin()">Login</button><button class="btn hidden" id="adminBtn" onclick="openAdmin()">Admin</button><button class="btn hidden" id="staffBtn" onclick="openStaff()">Staff</button><button class="btn hidden" id="logoutBtn" onclick="logout()">Logout</button>
<!-- LOGIN --><div class="modal" id="loginModal"><div class="modal-content"><h3>OTP Login</h3><input id="phone" placeholder="+91XXXXXXXXXX"><div id="recaptcha-container"></div><button class="btn" onclick="sendOTP()">Send OTP</button><input id="otp" placeholder="Enter OTP"><button class="btn" onclick="verifyOTP()">Verify</button></div></div>
<!-- ADMIN --><div class="modal" id="adminModal"><div class="modal-content"><h3>Admin Dashboard</h3><h4>Customers</h4><table><thead><tr><th>Phone</th><th>Visits</th></tr></thead><tbody id="adminCustomers"></tbody></table><button class="btn" onclick="closeAdmin()">Close</button></div></div>
<!-- STAFF --><div class="modal" id="staffModal"><div class="modal-content"><h3>Staff Dashboard</h3><p id="staffName"></p><table><thead><tr><th>Customer</th><th>Visits</th></tr></thead><tbody id="staffTable"></tbody></table><button class="btn" onclick="closeStaff()">Close</button></div></div>
<script type="module">import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";import { getAuth, signInWithPhoneNumber, RecaptchaVerifier } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";
const firebaseConfig = {  apiKey: "AIzaSyCqc07_iFk565ATUXfH0WN9X592-BpN454",  authDomain: "barber-shop-4c26f.firebaseapp.com",  projectId: "barber-shop-4c26f",  storageBucket: "barber-shop-4c26f.appspot.com",  messagingSenderId: "213114385226",  appId: "1:213114385226:web:dcdf67972a683f2055c7b3"};
const app = initializeApp(firebaseConfig);const auth = getAuth(app);const db = getFirestore(app);
/* OTP */window.recaptchaVerifier = new RecaptchaVerifier('recaptcha-container',{size:'normal'},auth);
window.sendOTP=()=>signInWithPhoneNumber(auth,phone.value,window.recaptchaVerifier).then(r=>{window.confirmationResult=r;alert("OTP Sent")}).catch(e=>alert(e.message));
window.verifyOTP = async ()=>{  const user = (await window.confirmationResult.confirm(otp.value)).user;  const phoneNo = user.phoneNumber;
  await updateCustomerVisit(phoneNo);  await showOffer(phoneNo);
  loginBtn.classList.add("hidden");  logoutBtn.classList.remove("hidden");
  if(await isAdmin(phoneNo)){    adminBtn.classList.remove("hidden");  }else if(await isStaff(phoneNo)){    staffBtn.classList.remove("hidden");    loadStaff(phoneNo);  }
  closeLogin();};
/* ROLES */async function isAdmin(phone){  return (await getDoc(doc(db,"admins",phone))).exists();}async function isStaff(phone){  return (await getDoc(doc(db,"staff",phone))).exists();}/* CUSTOMER VISITS */async function updateCustomerVisit(phone){  const ref=doc(db,"customers",phone);  const snap=await getDoc(ref);  if(snap.exists()){    await updateDoc(ref,{totalVisits:increment(1)});  }else{    await setDoc(ref,{phone,totalVisits:1});  }}
/* OFFERS */async function showOffer(phone){  const d=(await getDoc(doc(db,"customers",phone))).data();  let msg="";  if(d.totalVisits===3) msg=" 10% OFF!";  if(d.totalVisits===5) msg=" Free Beard Trim!";  if(d.totalVisits>=10) msg=" VIP 20% OFF!";  if(new Date().getMonth()===0) msg=" Pongal ₹50 OFF!";  if(msg) alert(msg);}
/* ADMIN */window.openAdmin=async()=>{ adminModal.classList.add("active"); adminCustomers.innerHTML=""; const q=await getDocs(collection(db,"customers")); q.forEach(d=>{   adminCustomers.innerHTML+=`<tr><td>${d.data().phone}</td><td>${d.data().totalVisits}</td></tr>`; });}window.closeAdmin=()=>adminModal.classList.remove("active");/* STAFF */async function loadStaff(phone){ const staff=(await getDoc(doc(db,"staff",phone))).data(); staffName.textContent="Staff: "+staff.name; staffTable.innerHTML=""; const q=await getDocs(collection(db,"customers")); q.forEach(d=>{   staffTable.innerHTML+=`<tr><td>${d.data().phone}</td><td>${d.data().totalVisits}</td></tr>`; });}window.openStaff=()=>staffModal.classList.add("active");window.closeStaff=()=>staffModal.classList.remove("active");
/* UI */window.openLogin=()=>loginModal.classList.add("active");window.closeLogin=()=>loginModal.classList.remove("active");window.logout=()=>location.reload();</script>
</body></html>
