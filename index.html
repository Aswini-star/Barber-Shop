<!DOCTYPE html>
<html>
<head>
  <title>Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<h2>Login</h2>
<input id="email" placeholder="Email"><br>
<input id="password" type="password" placeholder="Password"><br>
<button onclick="login()">Login</button>
<p id="msg"></p>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore-compat.js"></script>

<script>
/* ðŸ”¥ Firebase Init */
firebase.initializeApp({
  apiKey: "AIzaSyCqc07_iFk565ATUXfH0WN9X592-BpN454",
  authDomain: "barber-shop-4c26f.firebaseapp.com",
  projectId: "barber-shop-4c26f",
  storageBucket: "barber-shop-4c26f.firebasestorage.app",
  messagingSenderId: "213114385226",
  appId: "1:213114385226:web:dcdf67972a683f2055c7b3",
});

const auth = firebase.auth();
const db = firebase.firestore();

/* âš ï¸ TEMPORARY â€“ RUN ONCE, THEN DELETE */
auth.onAuthStateChanged(user => {
  if (user) {
    db.collection("users").doc(user.uid).set({
      role: "admin"
    });
    alert("Admin role assigned. REMOVE THIS CODE NOW!");
  }
});

/* âœ… LOGIN FUNCTION */
function login() {
  msg.innerText = "Logging in...";

  auth.signInWithEmailAndPassword(
    document.getElementById("email").value,
    document.getElementById("password").value
  )
  .then(res => db.collection("users").doc(res.user.uid).get())
  .then(doc => {

    if (!doc.exists) {
      msg.innerText = "User role not assigned.";
      auth.signOut();
      return;
    }

    const role = doc.data().role;

    if (role === "admin") location.href = "admin.html";
    else if (role === "staff") location.href = "staff.html";
    else if (role === "customer") location.href = "customer.html";
    else msg.innerText = "Invalid role";
  })
  .catch(e => {
    msg.innerText = e.message;
  });
}
</script>

</body>
</html>
