<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    signOut,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
  import {
    getFirestore,
    collection,
    addDoc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  // ðŸ”´ Replace with YOUR Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCqc07_iFk565ATUXfH0WN9X592-BpN454",
    authDomain: "barber-shop-4c26f.firebaseapp.com",
    projectId: "barber-shop-4c26f",
    storageBucket: "barber-shop-4c26f.firebasestorage.app",
    messagingSenderId: "213114385226",
    appId: "1:213114385226:web:dcdf67972a683f2055c7b3"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const status = document.getElementById("status");
  const appointmentSection = document.getElementById("appointment-section");
  const appointmentStatus = document.getElementById("appointment-status");

  // Auth state listener
  onAuthStateChanged(auth, (user) => {
    if (user) {
      status.innerText = "Logged in as: " + user.email;
      appointmentSection.style.display = "block";  // Show appointment form when logged in
    } else {
      status.innerText = "Not logged in";
      appointmentSection.style.display = "none";  // Hide appointment form when logged out
      appointmentStatus.innerText = "";
    }
  });

  document.getElementById("book-appointment").onclick = async () => {
    const date = document.getElementById("date").value;
    const time = document.getElementById("time").value;
    const user = auth.currentUser;

    if (!date || !time) {
      appointmentStatus.innerText = "Please select both date and time.";
      return;
    }

    if (!user) {
      appointmentStatus.innerText = "You must be logged in to book an appointment.";
      return;
    }

    try {
      // Save appointment to Firestore in 'appointments' collection
      await addDoc(collection(db, "appointments"), {
        userId: user.uid,
        email: user.email,
        date: date,
        time: time,
        createdAt: serverTimestamp()
      });

      appointmentStatus.innerText = `Appointment booked for ${date} at ${time}. Thank you!`;

      // Clear inputs
      document.getElementById("date").value = "";
      document.getElementById("time").value = "";

    } catch (error) {
      appointmentStatus.innerText = "Error booking appointment: " + error.message;
    }
  };

  document.getElementById("signup").onclick = async () => {
    try {
      await createUserWithEmailAndPassword(
        auth,
        email.value,
        password.value
      );
      alert("Signup successful");
    } catch (e) {
      alert(e.message);
    }
  };

  document.getElementById("login").onclick = async () => {
    try {
      await signInWithEmailAndPassword(
        auth,
        email.value,
        password.value
      );
      alert("Login successful");
    } catch (e) {
      alert(e.message);
    }
  };

  document.getElementById("logout").onclick = async () => {
    await signOut(auth);
    alert("Logged out");
  };
</script>
