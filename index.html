<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a1a">
    <title>Barber Shop - Home</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== ORIGINAL CSS (UNCHANGED) ===== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary-color: #1a1a1a; --accent-color: #d4af37; --success-color: #28a745;
            --danger-color: #dc3545; --text-color: #333333; --text-light: #666666;
            --background-color: #ffffff; --background-light: #f8f9fa; --border-color: #dddddd;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1); --shadow-md: 0 4px 8px rgba(0,0,0,0.15);
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--background-light); color: var(--text-color); line-height: 1.6; }
        .app-header { background-color: var(--primary-color); color: white; padding: 1rem; position: sticky; top: 0; z-index: 100; box-shadow: var(--shadow-md); }
        .header-content { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; }
        .logo { font-size: 1.5rem; font-weight: bold; color: var(--accent-color); }
        .nav-menu { position: fixed; bottom: 0; left: 0; right: 0; background-color: var(--primary-color); display: flex; justify-content: space-around; padding: 0.5rem; box-shadow: 0 -2px 4px rgba(0,0,0,0.1); }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: white; text-decoration: none; padding: 0.5rem; font-size: 0.75rem; min-width: 60px; }
        .nav-item i { font-size: 1.5rem; margin-bottom: 0.25rem; }
        .nav-item.active { color: var(--accent-color); }
        .app-main { max-width: 1200px; margin: 0 auto; padding: 1rem; padding-bottom: 80px; }
        .hero-section { background: linear-gradient(135deg, var(--primary-color) 0%, #333 100%); color: white; padding: 2rem; border-radius: 12px; text-align: center; margin-bottom: 2rem; }
        .hero-section h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .contact-actions { display: flex; gap: 1rem; margin-top: 1rem; }
        .contact-btn { flex: 1; display: flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 1rem; border-radius: 8px; text-decoration: none; color: white; font-weight: 600; min-height: 48px; }
        .contact-btn--call { background-color: #007bff; }
        .contact-btn--whatsapp { background-color: #25d366; }
        .section { background-color: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: var(--shadow-sm); }
        .service-grid { display: grid; grid-template-columns: 1fr; gap: 1rem; }
        @media (min-width: 640px) { .service-grid { grid-template-columns: repeat(2, 1fr); } }
        .service-card { border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; transition: transform 0.2s; }
        .service-card__image { width: 100%; height: 150px; object-fit: cover; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .service-card__content { padding: 1rem; }
        .service-card__price { font-size: 1.25rem; font-weight: bold; color: var(--accent-color); }
        .btn { background-color: var(--accent-color); border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 1rem; font-weight: 600; min-height: 48px; padding: 0.75rem 1.5rem; width: 100%; transition: all 0.3s; }
        .hidden { display: none; }
        .modal { display: none; position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 12px; padding: 2rem; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .form-input { width: 100%; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: 8px; font-size: 1rem; min-height: 48px; }
        .notification { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); background: var(--primary-color); color: white; padding: 1rem 2rem; border-radius: 8px; box-shadow: var(--shadow-md); z-index: 2000; transition: top 0.3s; }
        .notification.show { top: 20px; }
        .notification--success { background: var(--success-color); }
        .notification--error { background: var(--danger-color); }
    </style>
</head>

<body>
<header class="app-header">
  <div class="header-content">
    <div class="logo"><i class="fas fa-cut"></i> BarberShop</div>
    <div>
      <button class="btn" onclick="openLoginModal()" id="loginBtn"><i class="fas fa-user"></i> Login</button>
      <button class="btn hidden" id="profileBtn"><i class="fas fa-user-circle"></i> <span id="userName"></span></button>
    </div>
  </div>
</header>

<main class="app-main">
  <section class="hero-section">
    <h1>Welcome to BarberShop</h1>
    <div class="contact-actions">
      <a href="tel:+919876543210" class="contact-btn contact-btn--call"><i class="fas fa-phone"></i>Call</a>
      <a href="https://wa.me/919344741870" class="contact-btn contact-btn--whatsapp" target="_blank"><i class="fab fa-whatsapp"></i>WhatsApp</a>
    </div>
  </section>
</main>

<!-- ===== LOGIN MODAL (UNCHANGED UI) ===== -->
<div class="modal" id="loginModal">
  <div class="modal-content">
    <h2>Login</h2>

    <!-- Role select (NEW, minimal UI) -->
    <div class="form-group">
      <button class="btn" onclick="setRole('customer')">Customer</button>
      <button class="btn" onclick="setRole('staff')">Staff</button>
      <button class="btn" onclick="setRole('admin')">Admin</button>
    </div>

    <!-- Customer OTP -->
    <div id="customerLogin">
      <input type="tel" class="form-input" id="loginPhone" placeholder="10-digit mobile">
      <div id="recaptcha-container"></div>
      <button class="btn" onclick="sendOTP()">Send OTP</button>
      <input type="text" class="form-input" id="loginOTP" placeholder="Enter OTP">
      <button class="btn" onclick="verifyOTP()">Verify</button>
    </div>

    <!-- Staff/Admin email -->
    <div id="emailLogin" class="hidden">
      <input type="email" class="form-input" id="loginEmail" placeholder="Email">
      <input type="password" class="form-input" id="loginPassword" placeholder="Password">
      <button class="btn" onclick="emailLogin()">Login</button>
    </div>
  </div>
</div>

<div class="notification" id="notification"></div>

<!-- ===== FIREBASE (FIXED) ===== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, RecaptchaVerifier, signInWithPhoneNumber, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCqc07_iFk565ATUXfH0WN9X592-BpN454",
  authDomain: "barber-shop-4c26f.firebaseapp.com",
  projectId: "barber-shop-4c26f",
  storageBucket: "barber-shop-4c26f.appspot.com",
  messagingSenderId: "213114385226",
  appId: "1:213114385226:web:dcdf67972a683f2055c7b3"
};

// ❗ FIX 1: Single initialization only
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ❗ FIX 2: Proper reCAPTCHA container
window.recaptchaVerifier = new RecaptchaVerifier(
  'recaptcha-container',
  { size: 'invisible' },
  auth
);

// State
let role = 'customer';
let confirmationResult = null;

// UI helpers
window.openLoginModal = () => document.getElementById('loginModal').classList.add('active');
window.setRole = (r) => {
  role = r;
  document.getElementById('emailLogin').classList.toggle('hidden', r === 'customer');
  document.getElementById('customerLogin').classList.toggle('hidden', r !== 'customer');
};

// ❗ FIX 3: Correct IDs used for OTP
window.sendOTP = async () => {
  try {
    const phone = "+91" + document.getElementById('loginPhone').value.trim();
    confirmationResult = await signInWithPhoneNumber(auth, phone, window.recaptchaVerifier);
    notify("OTP sent", "success");
  } catch (e) {
    notify(e.message, "error");
  }
};

window.verifyOTP = async () => {
  try {
    await confirmationResult.confirm(document.getElementById('loginOTP').value.trim());
    localStorage.setItem('role', 'customer');
    notify("Login successful", "success");
    document.getElementById('loginModal').classList.remove('active');
  } catch (e) {
    notify("Invalid OTP", "error");
  }
};

// Staff/Admin email login (NEW, minimal)
window.emailLogin = async () => {
  try {
    await signInWithEmailAndPassword(
      auth,
      document.getElementById('loginEmail').value,
      document.getElementById('loginPassword').value
    );
    localStorage.setItem('role', role);
    notify(role + " login successful", "success");
    document.getElementById('loginModal').classList.remove('active');
  } catch (e) {
    notify(e.message, "error");
  }
};

// Firestore example save (booking/customer – ready to be called)
window.saveToFirestore = async (data) => {
  await addDoc(collection(db, "bookings"), data);
};

function notify(msg, type){
  const n=document.getElementById('notification');
  n.textContent=msg; n.className="notification notification--"+type+" show";
  setTimeout(()=>n.classList.remove('show'),3000);
}
</script>
</body>
</html>
