<!DOCTYPE html>
<html>
<head>
  <title>My Loan Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      margin: 0;
      padding: 16px;
      font-family: Arial, sans-serif;
      background: #f4f6f8;
    }

    h2 {
      text-align: center;
      margin-bottom: 16px;
    }

    .table-container {
      overflow-x: auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 320px;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
      font-size: 15px;
    }

    th {
      background: #1976d2;
      color: white;
    }

    tr:last-child td {
      border-bottom: none;
    }

    .pay-btn {
      margin-top: 20px;
      width: 100%;
      padding: 14px;
      background: #2e7d32;
      color: white;
      border: none;
      font-size: 16px;
      border-radius: 8px;
    }
  </style>
</head>

<body>

<h2>My Loan Details</h2>

<div class="table-container">
  <table>
    <tr>
      <th>Field</th>
      <th>Value</th>
    </tr>
    <tr>
      <td>Customer Name</td>
      <td id="cname">-</td>
    </tr>
    <tr>
      <td>Principal Amount</td>
      <td id="principal">-</td>
    </tr>
    <tr>
      <td>Outstanding Interest</td>
      <td id="interest">-</td>
    </tr>
    <tr>
      <td>Monthly Interest %</td>
      <td id="rate">-</td>
    </tr>
  </table>
</div>

<button class="pay-btn" onclick="pay()">Pay via UPI</button>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCqc07_iFk565ATUXfH0WN9X592-BpN454",
  authDomain: "barber-shop-4c26f.firebaseapp.com",
  projectId: "barber-shop-4c26f",
  storageBucket: "barber-shop-4c26f.firebasestorage.app",
  messagingSenderId: "213114385226",
  appId: "1:213114385226:web:dcdf67972a683f2055c7b3",
});

const auth = firebase.auth();
const db = firebase.firestore();

let upiId = "";

/* ðŸ” LOAD CUSTOMER DATA */
auth.onAuthStateChanged(user => {
  if (!user) return;

  db.collection("customers").doc(user.uid).get()
    .then(doc => {
      if (!doc.exists) {
        alert("Customer record not found");
        return;
      }

      const c = doc.data();

      document.getElementById("cname").innerText = c.name || "-";
      document.getElementById("principal").innerText = "â‚¹ " + c.principal;
      document.getElementById("interest").innerText = "â‚¹ " + c.interest;
      document.getElementById("rate").innerText = c.rate + " %";

      upiId = c.upi;
    });
});

/* ðŸ’¸ UPI PAYMENT */
function pay() {
  if (!upiId) {
    alert("UPI ID not available");
    return;
  }
  location.href = `upi://pay?pa=${upiId}&pn=LoanPayment`;
}
</script>

</body>
</html>
